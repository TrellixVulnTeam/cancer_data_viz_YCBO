{"ast":null,"code":"import*as d3 from'd3';export function drawChart(){var margin={top:20,left:75,bottom:50,right:50},width=850-margin.left-margin.right,height=500-margin.top-margin.bottom;var svg=d3.select('#chart').append('svg').attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append('g').attr('transform','translate('+margin.left+', '+margin.top+')');var x=d3.scaleBand();var y=d3.scaleLinear();var top3,bot3;var delay=function(d,i){return i*50;};var all,orderName;var current,sortMode,filterMode;d3.csv(\"https://raw.githubusercontent.com/hkerkevin/dsci554/main/dx_race.csv\",d=>{return{race:d.race,dx:+d.dx};}).then(data=>{all=data;console.log(JSON.stringify(all));//ðŸŽ’ set top5 to top 5 gdps in the group of countries using array.slice here\ntop3=data.sort((a,b)=>d3.descending(a.dx,b.dx)).slice(0,3);//ðŸŽ’ set bot5 to bottom 5 gdps in the group of countries using array.slice here\nbot3=data.sort((a,b)=>d3.ascending(a.dx,b.dx)).slice(0,3);filter('#all');sort('#gdp_a');toggleFilter('#all');toggleSort('#gdp_a');draw();});//sort event handlers\nd3.select('#gdp_a').on('click',()=>{sort('#gdp_a');transition();toggleSort('#gdp_a');});d3.select('#gdp_b').on('click',()=>{sort('#gdp_b');transition();toggleSort('#gdp_b');});d3.select('#orderName').on('click',()=>{sort('#orderName');transition();toggleSort('#orderName');});d3.select('#reset').on('click',()=>{filter('#all');sort('#orderName');toggleSort(sortMode);toggleFilter('#all');transition();toggleSort('#reset');redraw();});////\n//filter event handlers\nd3.select('#all').on('click',()=>{filter('#all');sort(sortMode);toggleSort(sortMode);toggleFilter('#all');redraw();});d3.select('#top5').on('click',()=>{filter('#top5');sort(sortMode);toggleSort(sortMode);toggleFilter('#top5');redraw();});d3.select('#bot5').on('click',()=>{filter('#bot5');sort(sortMode);toggleSort(sortMode);toggleFilter('#bot5');redraw();});d3.select('input').on('change',()=>{sort(sortMode);toggleSort(sortMode);redraw();});function filter(mode){if(mode==='#all'){current=JSON.parse(JSON.stringify(all));}else if(mode==='#top5'){current=JSON.parse(JSON.stringify(top3));}else if(mode==='#bot5'){current=JSON.parse(JSON.stringify(bot3));}filterMode=mode;}function sort(mode){if(mode==='#gdp_a'){current.sort((a,b)=>d3.ascending(a.dx,b.dx));}else if(mode==='#gdp_b'){current.sort((a,b)=>d3.descending(a.dx,b.dx));}else if(mode==='#orderName'){current.sort((a,b)=>d3.ascending(a.race,b.race));}x.domain(current.map(d=>d.race));sortMode=mode;}function toggleSort(id){d3.selectAll('.sort').style('background-color','#eee');d3.select(id).style('background-color','lightblue');}//ðŸŽ’ implement toggleFilter to highlight buttons with class .filter here (same as toggleSort with class .sort)\nfunction toggleFilter(id){d3.selectAll('.filter').style('background-color','#eee');d3.select(id).style('background-color','lightblue');}///\nfunction redraw(){//update scale\nx.domain(current.map(d=>d.race));////////////////////////////////\n// DATA JOIN FOR BARS.\nvar bars=svg.selectAll('.bar').data(current,d=>d.race);// UPDATE.\nbars.transition().duration(750).delay(delay).attr('x',d=>x(d.race)).attr('width',x.bandwidth());// ENTER.\nbars.enter().append('rect').attr('x',d=>x(d.race)).attr('y',d=>y(0)).attr('width',x.bandwidth()).transition().duration(750).attr('class','bar').attr('x',d=>x(d.race)).attr('y',d=>y(d.dx)).attr('width',x.bandwidth()).attr('height',d=>height-y(d.dx));// EXIT.\nbars.exit().transition().duration(750).style('opacity',0).remove();////////////////////////////////\n// DATA JOIN FOR NAMES.\nvar name=svg.selectAll('.name').data(current,d=>d.race);// UPDATE.\nname.transition().duration(750).delay(delay).attr('x',(d,i)=>x(d.race)+x.bandwidth()/2);// ENTER.\nname.enter().append('text').attr('x',d=>x(d.race)+x.bandwidth()/2).attr('y',d=>y(d.dx)+(height-y(d.dx))/2).style('opacity',0).transition().duration(1000).text(d=>d.race).attr('class','name').attr('x',d=>x(d.race)+x.bandwidth()/2).attr('y',d=>y(d.dx)+(height-y(d.dx))/2).style('opacity',1);// EXIT.\nname.exit().transition().duration(750).style('opacity',0).remove();}function transition(){var transition=svg.transition().duration(750);transition.selectAll('.bar').delay(delay).attr('x',d=>x(d.race));transition.selectAll('.name').delay(delay).attr('x',d=>x(d.race)+x.bandwidth()/2);}function draw(){x.domain(current.map(d=>d.race)).range([0,width]).paddingInner(0.2);y.domain([0,d3.max(current,d=>d.dx)]).range([height,0]);svg.selectAll('.bar').data(current,d=>d.race).enter().append('rect').attr('class','bar').attr('x',d=>x(d.race)).attr('y',d=>y(d.dx)).attr('width',x.bandwidth()).attr('height',d=>height-y(d.dx));svg.selectAll('.name').data(current,d=>d.race).enter().append('text').text(d=>d.race).attr('class','name').attr('x',d=>x(d.race)+x.bandwidth()/2).attr('y',d=>y(d.dx)+(height-y(d.dx))/2);var xAxis;xAxis=d3.axisBottom().scale(x).ticks(0).tickSize(0).tickFormat('');svg.append('g').attr('class','axis').attr('transform','translate(0,'+height+')').call(xAxis);svg.append('text').attr('class','xlabel').text('smaller').attr('x',30).attr('y',height+20);svg.append('text').attr('class','xlabel').text('larger').attr('x',width-30).attr('y',height+20);var yAxis=d3.axisLeft().scale(y).ticks(5,'d');svg.append('g').attr('class','axis').call(yAxis);svg.append('text').attr('x',-height/2).attr('y',-margin.left*0.7).attr('transform','rotate(-90)').attr('class','ylabel').append('tspan').text('Total diagonsed cases by race').append('tspan').text('-2').style('baseline-shift','super').style('font-size','0.7em');}}","map":{"version":3,"sources":["/Users/carlin/Desktop/USC_classes/DSCI_554/project-datadocs-real/demo/src/views/charts/BarChartDemographics.js"],"names":["d3","drawChart","margin","top","left","bottom","right","width","height","svg","select","append","attr","x","scaleBand","y","scaleLinear","top3","bot3","delay","d","i","all","orderName","current","sortMode","filterMode","csv","race","dx","then","data","console","log","JSON","stringify","sort","a","b","descending","slice","ascending","filter","toggleFilter","toggleSort","draw","on","transition","redraw","mode","parse","domain","map","id","selectAll","style","bars","duration","bandwidth","enter","exit","remove","name","text","range","paddingInner","max","xAxis","axisBottom","scale","ticks","tickSize","tickFormat","call","yAxis","axisLeft"],"mappings":"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","sourcesContent":["\nimport * as d3 from 'd3';\n\nexport function drawChart(){\n\nvar margin = { top: 20, left: 75, bottom: 50, right: 50 },\n    width = 850 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar svg = d3.select('#chart').append('svg')\n    .attr('width', width + margin.left + margin.right)\n    .attr('height', height + margin.top + margin.bottom)\n    .append('g')\n    .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')');\n\nvar x = d3.scaleBand();\nvar y = d3.scaleLinear();\n\nvar top3, bot3;\n\nvar delay = function (d, i) {\n    return i * 50;\n};\n\nvar all, orderName;\nvar current, sortMode, filterMode;\n\nd3.csv(\"https://raw.githubusercontent.com/hkerkevin/dsci554/main/dx_race.csv\", d => {\n    return {\n        race: d.race,\n        dx: +d.dx\n    };\n}).then(data => {\n    all = data;\n    console.log(JSON.stringify(all));\n\n    //ðŸŽ’ set top5 to top 5 gdps in the group of countries using array.slice here\n    top3 = data.sort((a, b) => d3.descending(a.dx, b.dx)).slice(0, 3);\n\n    //ðŸŽ’ set bot5 to bottom 5 gdps in the group of countries using array.slice here\n    bot3 = data.sort((a, b) => d3.ascending(a.dx, b.dx)).slice(0, 3);\n\n\n    filter('#all');\n    sort('#gdp_a');\n\n    toggleFilter('#all');\n    toggleSort('#gdp_a');\n\n    draw();\n});\n\n//sort event handlers\nd3.select('#gdp_a')\n    .on('click', () => {\n        sort('#gdp_a');\n        transition();\n        toggleSort('#gdp_a');\n    });\n\nd3.select('#gdp_b')\n    .on('click', () => {\n        sort('#gdp_b');\n        transition();\n        toggleSort('#gdp_b');\n    });\n\n\nd3.select('#orderName')\n    .on('click', () => {\n        sort('#orderName');\n        transition();\n        toggleSort('#orderName');\n    });\n\nd3.select('#reset')\n    .on('click', () => {\n        filter('#all');\n        sort('#orderName');\n\n        toggleSort(sortMode);\n        toggleFilter('#all');\n\n        transition();\n        toggleSort('#reset');\n\n        redraw();\n    });\n\n////\n\n//filter event handlers\nd3.select('#all')\n    .on('click', () => {\n        filter('#all');\n        sort(sortMode);\n\n        toggleSort(sortMode);\n        toggleFilter('#all');\n\n        redraw();\n    });\n\nd3.select('#top5')\n    .on('click', () => {\n        filter('#top5');\n        sort(sortMode);\n\n        toggleSort(sortMode);\n        toggleFilter('#top5');\n\n        redraw();\n    });\n\nd3.select('#bot5')\n    .on('click', () => {\n        filter('#bot5');\n        sort(sortMode);\n\n        toggleSort(sortMode);\n        toggleFilter('#bot5');\n\n        redraw();\n    });\n\nd3.select('input')\n    .on('change', () => {\n\n        sort(sortMode);\n        toggleSort(sortMode);\n\n        redraw();\n    });\n\nfunction filter(mode) {\n    if (mode === '#all') {\n        current = JSON.parse(JSON.stringify(all));\n    } else if (mode === '#top5') {\n        current = JSON.parse(JSON.stringify(top3));\n    } else if (mode === '#bot5') {\n        current = JSON.parse(JSON.stringify(bot3));\n    }\n    filterMode = mode;\n}\n\nfunction sort(mode) {\n    if (mode === '#gdp_a') {\n        current.sort((a, b) => d3.ascending(a.dx, b.dx));\n    } else if (mode === '#gdp_b') {\n        current.sort((a, b) => d3.descending(a.dx, b.dx));\n    } else if (mode === '#orderName') {\n        current.sort((a, b) => d3.ascending(a.race, b.race));\n    }\n    x.domain(current.map(d => d.race));\n    sortMode = mode;\n}\n\nfunction toggleSort(id) {\n    d3.selectAll('.sort')\n        .style('background-color', '#eee');\n    d3.select(id)\n        .style('background-color', 'lightblue');\n}\n\n//ðŸŽ’ implement toggleFilter to highlight buttons with class .filter here (same as toggleSort with class .sort)\nfunction toggleFilter(id) {\n    d3.selectAll('.filter')\n        .style('background-color', '#eee');\n    d3.select(id)\n        .style('background-color', 'lightblue');\n}\n///\n\nfunction redraw() {\n    //update scale\n    x.domain(current.map(d => d.race));\n\n    ////////////////////////////////\n    // DATA JOIN FOR BARS.\n    var bars = svg.selectAll('.bar')\n        .data(current, d => d.race);\n\n    // UPDATE.\n    bars.transition()\n        .duration(750)\n        .delay(delay)\n        .attr('x', d => x(d.race))\n        .attr('width', x.bandwidth());\n\n    // ENTER.\n    bars.enter()\n        .append('rect')\n        .attr('x', d => x(d.race))\n        .attr('y', d => y(0))\n        .attr('width', x.bandwidth())\n        .transition()\n        .duration(750)\n        .attr('class', 'bar')\n        .attr('x', d => x(d.race))\n        .attr('y', d => y(d.dx))\n        .attr('width', x.bandwidth())\n        .attr('height', d => height - y(d.dx));\n\n    // EXIT.\n    bars.exit()\n        .transition()\n        .duration(750)\n        .style('opacity', 0)\n        .remove();\n\n    ////////////////////////////////\n    // DATA JOIN FOR NAMES.\n    var name = svg.selectAll('.name')\n        .data(current, d => d.race);\n\n    // UPDATE.\n    name.transition()\n        .duration(750)\n        .delay(delay)\n        .attr('x', (d, i) => x(d.race) + x.bandwidth() / 2);\n\n    // ENTER.\n    name.enter()\n        .append('text')\n        .attr('x', d => x(d.race) + x.bandwidth() / 2)\n        .attr('y', d => y(d.dx) + (height - y(d.dx)) / 2)\n        .style('opacity', 0)\n        .transition()\n        .duration(1000)\n        .text(d => d.race)\n        .attr('class', 'name')\n        .attr('x', d => x(d.race) + x.bandwidth() / 2)\n        .attr('y', d => y(d.dx) + (height - y(d.dx)) / 2)\n        .style('opacity', 1);\n\n    // EXIT.\n    name.exit()\n        .transition()\n        .duration(750)\n        .style('opacity', 0)\n        .remove();\n}\n\nfunction transition() {\n    var transition = svg.transition()\n        .duration(750);\n\n    transition.selectAll('.bar')\n        .delay(delay)\n        .attr('x', d => x(d.race));\n\n    transition.selectAll('.name')\n        .delay(delay)\n        .attr('x', d => x(d.race) + x.bandwidth() / 2);\n}\n\nfunction draw() {\n    x.domain(current.map(d => d.race))\n        .range([0, width])\n        .paddingInner(0.2);\n\n    y.domain([0, d3.max(current, d => d.dx)])\n        .range([height, 0]);\n\n    svg.selectAll('.bar')\n        .data(current, d => d.race)\n        .enter()\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('x', d => x(d.race))\n        .attr('y', d => y(d.dx))\n        .attr('width', x.bandwidth())\n        .attr('height', d => height - y(d.dx));\n\n    svg.selectAll('.name')\n        .data(current, d => d.race)\n        .enter()\n        .append('text')\n        .text(d => d.race)\n        .attr('class', 'name')\n        .attr('x', d => x(d.race) + x.bandwidth() / 2)\n        .attr('y', d => y(d.dx) + (height - y(d.dx)) / 2);\n\n    var xAxis;\n    xAxis = d3.axisBottom()\n        .scale(x)\n        .ticks(0)\n        .tickSize(0)\n        .tickFormat('');\n\n    svg.append('g')\n        .attr('class', 'axis')\n        .attr('transform', 'translate(0,' + height + ')')\n        .call(xAxis);\n\n    svg.append('text')\n        .attr('class', 'xlabel')\n        .text('smaller')\n        .attr('x', 30)\n        .attr('y', height + 20);\n\n    svg.append('text')\n        .attr('class', 'xlabel')\n        .text('larger')\n        .attr('x', width - 30)\n        .attr('y', height + 20);\n\n    var yAxis = d3.axisLeft()\n        .scale(y)\n        .ticks(5, 'd');\n\n    svg.append('g')\n        .attr('class', 'axis')\n        .call(yAxis);\n\n    svg.append('text')\n        .attr('x', - height / 2)\n        .attr('y', - margin.left * 0.7)\n        .attr('transform', 'rotate(-90)')\n        .attr('class', 'ylabel')\n        .append('tspan').text('Total diagonsed cases by race')\n        .append('tspan').text('-2')\n        .style('baseline-shift', 'super')\n        .style('font-size', '0.7em');\n}\n\n}"]},"metadata":{},"sourceType":"module"}