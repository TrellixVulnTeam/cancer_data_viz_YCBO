{"ast":null,"code":"import * as d3 from 'd3';\nexport function drawMap(height, width) {\n  function legend() {\n    let {\n      color,\n      title,\n      tickSize = 6,\n      width = 800,\n      height = 50 + tickSize,\n      marginTop = 18,\n      marginRight = 0,\n      marginBottom = 16 + tickSize,\n      marginLeft = 0,\n      ticks = width / 64,\n      tickFormat,\n      tickValues\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const svg = d3.create(\"svg\").attr(\"width\", width).attr(\"height\", height).attr(\"viewBox\", [0, 0, width, height]).style(\"overflow\", \"visible\").style(\"display\", \"block\");\n    let x; // Continuous\n\n    if (color.interpolator) {\n      x = Object.assign(color.copy().interpolator(d3.interpolateRound(marginLeft, width - marginRight)), {\n        range() {\n          return [marginLeft, width - marginRight];\n        }\n\n      });\n      svg.append(\"image\").attr(\"x\", marginLeft).attr(\"y\", marginTop).attr(\"width\", width - marginLeft - marginRight).attr(\"height\", height - marginTop - marginBottom).attr(\"preserveAspectRatio\", \"none\").attr(\"xlink:href\", ramp(color.interpolator()).toDataURL()); //scaleSequentialQuantile doesnâ€™t implement ticks or tickFormat.\n\n      if (!x.ticks) {\n        if (tickValues === undefined) {\n          const n = Math.round(ticks + 1);\n          tickValues = d3.range(n).map(i => d3.quantile(color.domain(), i / (n - 1)));\n        }\n\n        if (typeof tickFormat !== \"function\") {\n          tickFormat = d3.format(tickFormat === undefined ? \",f\" : tickFormat);\n        }\n      }\n    } //discrete\n    else if (color.invertExtent) {\n      const thresholds = color.thresholds ? color.thresholds() // scaleQuantize\n      : color.quantiles ? color.quantiles() // scaleQuantile\n      : color.domain(); // scaleThreshold\n\n      const thresholdFormat = tickFormat === undefined ? d => d : typeof tickFormat === \"string\" ? d3.format(tickFormat) : tickFormat;\n      x = d3.scaleLinear().domain([-1, color.range().length - 1]).rangeRound([marginLeft, width - marginRight]);\n      svg.append(\"g\").selectAll(\"rect\").data(color.range()).join(\"rect\").attr(\"x\", (d, i) => x(i - 1)).attr(\"y\", marginTop).attr(\"width\", (d, i) => x(i) - x(i - 1)).attr(\"height\", height - marginTop - marginBottom).attr(\"fill\", d => d);\n      tickValues = d3.range(thresholds.length);\n\n      tickFormat = i => thresholdFormat(thresholds[i], i);\n    }\n\n    svg.append(\"g\").attr(\"transform\", \"translate(0, \".concat(height - marginBottom, \")\")).call(d3.axisBottom(x).ticks(ticks, typeof tickFormat === \"string\" ? tickFormat : undefined).tickFormat(typeof tickFormat === \"function\" ? tickFormat : undefined).tickSize(tickSize).tickValues(tickValues)).call(g => g.selectAll(\".tick line\").attr(\"y1\", marginTop + marginBottom - height)).call(g => g.select(\".domain\").remove()).call(g => g.append(\"text\").attr(\"y\", marginTop + marginBottom - height - 6).attr(\"fill\", \"currentColor\").attr(\"text-anchor\", \"start\").attr(\"font-weight\", \"bold\").text(title));\n    return svg.node();\n  }\n\n  function ramp(color) {\n    let n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 256;\n    const canvas = DOM.canvas(n, 1);\n    const context = canvas.getContext(\"2d\");\n\n    for (let i = 0; i < n; ++i) {\n      context.fillStyle = color(i / (n - 1));\n      context.fillRect(i, 0, 1, 1);\n    }\n\n    return canvas;\n  } /////////////////////////////////////////////////////////////\n\n\n  var promises = [];\n  promises.push(d3.json(\"data/coh_area_rw.json\"));\n  promises.push(d3.json(\"data/data.json\"));\n  Promise.all(promises).then(function (values) {\n    var la_map = values[0];\n    var canc_data = values[1];\n    var data = values[2];\n    color = d3.scaleQuantize([0, 36], d3.schemeReds[9]);\n    console.log(canc_data);\n    canc_data = Object.assign(new Map(canc_data.slice(1).map(_ref => {\n      let [zip_code, zip_canc_deaths_10k] = _ref;\n      return [zip_code, +zip_canc_deaths_10k];\n    })));\n    canc_data.title = \"2019 cancer deaths per 10k\";\n    console.log(data);\n    console.log(canc_data);\n    var svg = d3.select('#chor1'),\n        width = +svg.attr('width'),\n        height = +svg.attr('height');\n    projection = d3.geoMercator().fitSize([width, height], la_map);\n    path = d3.geoPath().projection(projection);\n    svg.append(\"g\").attr(\"transform\", \"translate(610,20)\").append(() => legend({\n      color,\n      title: canc_data.title,\n      width: 200\n    }));\n    svg.append('g').attr('class', 'zipcodes').selectAll(\"path\").data(la_map.features).enter().append('path').attr('d', path).attr(\"fill\", d => color(canc_data.get(d.properties.zcta))).on('mouseover', function (d) {\n      d3.select('#chor_info1').text('Zip code: ' + this.__data__.properties.zcta + ' - Total population: ' + this.__data__.properties.tot_pop + ' - Median age: ' + this.__data__.properties.age_median + ' years');\n    });\n    coh_hosp = [-117.97265500193778, 34.131232240226815];\n    marker = projection(coh_hosp);\n    svg.append('circle').attr('cx', marker[0]).attr('cy', marker[1]).attr('fill', 'pink').style(\"stroke\", 'darkred').style(\"stroke-width\", 0.8).attr('r', 8);\n  });\n}","map":{"version":3,"sources":["/Users/HHJ/Dropbox/Class/2021/DSCI554/Github/project-datadocs/demo/src/views/charts/MapChart.js"],"names":["d3","drawMap","height","width","legend","color","title","tickSize","marginTop","marginRight","marginBottom","marginLeft","ticks","tickFormat","tickValues","svg","create","attr","style","x","interpolator","Object","assign","copy","interpolateRound","range","append","ramp","toDataURL","undefined","n","Math","round","map","i","quantile","domain","format","invertExtent","thresholds","quantiles","thresholdFormat","d","scaleLinear","length","rangeRound","selectAll","data","join","call","axisBottom","g","select","remove","text","node","canvas","DOM","context","getContext","fillStyle","fillRect","promises","push","json","Promise","all","then","values","la_map","canc_data","scaleQuantize","schemeReds","console","log","Map","slice","zip_code","zip_canc_deaths_10k","projection","geoMercator","fitSize","path","geoPath","features","enter","get","properties","zcta","on","__data__","tot_pop","age_median","coh_hosp","marker"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\n\nexport function drawMap(height, width){\n    \nfunction legend({\n    color,\n    title,\n    tickSize = 6,\n    width = 800,\n    height = 50 + tickSize,\n    marginTop = 18,\n    marginRight = 0,\n    marginBottom = 16 + tickSize,\n    marginLeft = 0,\n    ticks = width / 64,\n    tickFormat,\n    tickValues\n} = {}) {  \n\n    const svg = d3.create(\"svg\")\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n        .attr(\"viewBox\", [0, 0, width, height])\n        .style(\"overflow\", \"visible\")\n        .style(\"display\", \"block\");\n\n    let x;\n\n    // Continuous\n    if (color.interpolator) {\n        x = Object.assign(color.copy()\n            .interpolator(d3.interpolateRound(marginLeft, width - marginRight)),\n            { range() { return [marginLeft, width - marginRight]; } });\n\n        svg.append(\"image\")\n            .attr(\"x\", marginLeft)\n            .attr(\"y\", marginTop)\n            .attr(\"width\", width - marginLeft - marginRight)\n            .attr(\"height\", height - marginTop - marginBottom)\n            .attr(\"preserveAspectRatio\", \"none\")\n            .attr(\"xlink:href\", ramp(color.interpolator()).toDataURL());\n\n        //scaleSequentialQuantile doesnâ€™t implement ticks or tickFormat.\n        if (!x.ticks) {\n            if (tickValues === undefined) {\n                const n = Math.round(ticks + 1);\n                tickValues = d3.range(n).map(i => d3.quantile(color.domain(), i / (n - 1)));\n            }\n            if (typeof tickFormat !== \"function\") {\n                tickFormat = d3.format(tickFormat === undefined ? \",f\" : tickFormat);\n            }\n        }\n    }\n\n    //discrete\n    else if (color.invertExtent) {\n        const thresholds\n            = color.thresholds ? color.thresholds() // scaleQuantize\n                : color.quantiles ? color.quantiles() // scaleQuantile\n                    : color.domain(); // scaleThreshold\n\n        const thresholdFormat\n            = tickFormat === undefined ? d => d\n                : typeof tickFormat === \"string\" ? d3.format(tickFormat)\n                    : tickFormat;\n\n        x = d3.scaleLinear()\n            .domain([-1, color.range().length - 1])\n            .rangeRound([marginLeft, width - marginRight]);\n\n        svg.append(\"g\")\n            .selectAll(\"rect\")\n            .data(color.range())\n            .join(\"rect\")\n            .attr(\"x\", (d, i) => x(i - 1))\n            .attr(\"y\", marginTop)\n            .attr(\"width\", (d, i) => x(i) - x(i - 1))\n            .attr(\"height\", height - marginTop - marginBottom)\n            .attr(\"fill\", d => d);\n\n        tickValues = d3.range(thresholds.length);\n        tickFormat = i => thresholdFormat(thresholds[i], i);\n    }\n\n    svg.append(\"g\")\n        .attr(\"transform\", `translate(0, ${height - marginBottom})`)\n        .call(d3.axisBottom(x)\n            .ticks(ticks, typeof tickFormat === \"string\" ? tickFormat : undefined)\n            .tickFormat(typeof tickFormat === \"function\" ? tickFormat : undefined)\n            .tickSize(tickSize)\n            .tickValues(tickValues))\n        .call(g => g.selectAll(\".tick line\").attr(\"y1\", marginTop + marginBottom - height))\n        .call(g => g.select(\".domain\").remove())\n        .call(g => g.append(\"text\")\n            .attr(\"y\", marginTop + marginBottom - height - 6)\n            .attr(\"fill\", \"currentColor\")\n            .attr(\"text-anchor\", \"start\")\n            .attr(\"font-weight\", \"bold\")\n            .text(title));\n\n    return svg.node();\n}\n\nfunction ramp(color, n = 256) {\n    const canvas = DOM.canvas(n, 1);\n    const context = canvas.getContext(\"2d\");\n    for (let i = 0; i < n; ++i) {\n        context.fillStyle = color(i / (n - 1));\n        context.fillRect(i, 0, 1, 1);\n    }\n    return canvas;\n}\n\n/////////////////////////////////////////////////////////////\n\nvar promises = [];\n\npromises.push(d3.json(\"data/coh_area_rw.json\"));\npromises.push(d3.json(\"data/data.json\"));\n\nPromise.all(promises).then(function (values) {  \n    var la_map = values[0];\n    var canc_data = values[1];\n    var data = values[2]\n\n    color = d3.scaleQuantize([0, 36], d3.schemeReds[9])  \n    console.log(canc_data)\n\n    canc_data = Object.assign(new Map(canc_data.slice(1).map(([zip_code,zip_canc_deaths_10k]) => [zip_code, +zip_canc_deaths_10k])));  \n\n    canc_data.title = \"2019 cancer deaths per 10k\";\n\n    console.log(data)\n    console.log(canc_data)\n    var svg = d3.select('#chor1'),\n        width = +svg.attr('width'),\n        height = +svg.attr('height');\n    projection = d3.geoMercator()\n        .fitSize([width, height], la_map);\n    path = d3.geoPath()\n        .projection(projection);\n\n    svg.append(\"g\")\n        .attr(\"transform\", \"translate(610,20)\")\n        .append(() => legend({ color, title: canc_data.title, width: 200 }));\n\n    svg.append('g')\n        .attr('class', 'zipcodes')\n        .selectAll(\"path\")\n        .data(la_map.features)\n        .enter()\n        .append('path')\n        .attr('d', path)\n        .attr(\"fill\", d => color(canc_data.get(d.properties.zcta))) \n        .on('mouseover', function (d) {\n            d3.select('#chor_info1')\n                .text('Zip code: ' +  this.__data__.properties.zcta +  ' - Total population: ' +  this.__data__.properties.tot_pop + ' - Median age: ' +  this.__data__.properties.age_median + ' years');               \n            })\n        ;\n\n\n    coh_hosp = [-117.97265500193778, 34.131232240226815];\n\n    marker = projection(coh_hosp);\n    svg.append('circle')\n        .attr('cx', marker[0])\n        .attr('cy', marker[1])\n        .attr('fill', 'pink')\n        .style(\"stroke\", 'darkred')\n        .style(\"stroke-width\", 0.8)\n        .attr('r', 8);\n\n});\n\n}\n"]},"metadata":{},"sourceType":"module"}